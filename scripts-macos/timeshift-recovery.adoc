= Timeshift Recovery

Grand Unified Boot Loader (Grub)

== Core iMac17,1 Issue
Reboots DO NOT reload Ubuntu LTS 24.04. Instead a Grub terminal seems to open.

By powering up with the option key held, it is possible to see three devices (for all three choices, it is possible to pick a WiFi network):

* *EFI Boot (SSD)* - This is the startup partition that, when selected, brings up the grub terminal.
* *Macintosh HD (SSD)* - The brings up a circle with a line through it and the message "suport.apple.com/mac/startup"
* *EFI Boot (USB 24.04 stick)* - This brings up the USB Drive with four options. The first option "Try or Install Ubuntu" is also the default option and will autostart if not selected.

== Recovery with Timeshift

When Ubuntu starts from the USB stick, the first step is to map out the filesystem. The `lsblk` output includes:

----
/sdb (1.8T)
  / sdb1 (1.4T)  .. Reserved for deja-dup
  / sdb2 (.5T)   .. Used by Timesheet
----

The iMac ssd is seen as ...

----
/sda (931.5G)
  /sda1 (1G)
  /sda2 (2G)ß
  /sda3 (928.5G)
    ubuntu--vg-ubuntu- -lv 252:0 (928.5G) .. LVM Physical Volume
----

Looking inside the LVM Physical Volume, there is:

* ubuntu--vg ... The Volume Group
* ubuntu--lv ... The Logical Volume (LVM)

Thus the logical volume (/dev/ubuntu--vg/ubuntu--lv) is functionally the root filesystem (/).

IMPORTANT::
 /dev/sda3 is not directly `/` → it’s a container for the LVM. +
 /dev/ubuntu--vg/ubuntu--lv is the actual `/`.

.Activate the LVM (okay to call if already active):
----
sudo vgchange -ay
----

.Mount Root Logical Volue
----
sudo mount /dev/ubuntu--vg/ubuntu--lv /mnt
----

Once mounted, Timeshift can use /mnt as the “root” for the restore.

NOTE:
Timesheet will ask for the target path /. The following steps facililate providing the answer.

.Additional Debugging Options
----
sudo pvscan           # Scan for physical volumes
sudo vgscan           # Scan for volume groups
sudo lvscan           # Scan for logical volumes
sudo vgchange -ay     # Activate all volume groups
----

With the above completed ...

.lsblk
----
R E F R E S H   H E R E
----

SEE DISCUSSION IN "backup strtegy for ubuntu" (ChatGPT)

... resulting in

----
# Boot a Live USB - e.g., Try Unbuntu (Step 1 from ChatGPT)
# Activate and mount root (Step 2 ...)
sudo vgchange -ay
sudo mount /dev/ubuntu--vg/ubuntu--lv /mnt

# Mount the real EFI partition (Step 3 ...)
sudo mount /dev/nvme0n1p1 /mnt/boot/efi

# Bind system mounts (Step 4 ...)
sudo mount --bind /dev /mnt/dev
sudo mount --bind /proc /mnt/proc
sudo mount --bind /sys /mnt/sys

# Enter chroot (Step 5 ...)
sudo chroot /mnt
# chroot: failed to run command '/bin/bash': No such file or directory.
# Option suggested in ChatGPT follow up
sudo chroot /mnt /usr/bin/bash

# Reinstall GRUB to EFI partition (Step 6 ...)
## For UEFI:
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=ubuntu
update-grub
## For BIOS/Legacy
# grub-install /dev/sda
# update-grub

# Exit + unmount (Step 7 ...)
exit
sudo umount /mnt/dev /mnt/proc /mnt/sys
sudo umount /mnt/boot/efi
sudo umount /mnt

# Reboot (Step 8)
sudo reboot
----

Then `sudo reboot`
